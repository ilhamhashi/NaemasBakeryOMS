<UserControl x:Class="OrderManagerDesktopUI.Views.NewOrderView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:OrderManagerDesktopUI.Views"
        xmlns:vm="clr-namespace:OrderManagerDesktopUI.ViewModels" 
        xmlns:Icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
        mc:Ignorable="d"
        d:DesignHeight="800" d:DesignWidth="1200">

    <Grid>
        <!-- Definerer kolonner -->
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="70*"/>
            <ColumnDefinition Width="30*"/>
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="65*"/>
            <RowDefinition Height="8*"/>
            <RowDefinition Height="27*"/>
        </Grid.RowDefinitions>


        <Border Style="{StaticResource whiteBorder}" Margin="15 0 15 7">
            <DataGrid RowStyle="{DynamicResource DataGridRowStyle1}" 
              ColumnHeaderStyle="{DynamicResource DataGridColumnHeaderStyle1}" 
              CellStyle="{DynamicResource DataGridCellStyle1}" 
              Style="{DynamicResource DataGridStyle1}"
              ItemsSource="{Binding ProductsView, UpdateSourceTrigger=PropertyChanged}"
              SelectedItem="{Binding SelectedProduct, UpdateSourceTrigger=PropertyChanged}"
              VerticalAlignment="Stretch"
                AutoGenerateColumns="false">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="No." IsReadOnly="True" CanUserResize="False" Width="auto" 
                                Binding="{Binding Id, UpdateSourceTrigger=PropertyChanged}"/>
                    <DataGridTextColumn Header="Name" IsReadOnly="True" Width="*"
                                Binding="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
                    <DataGridTextColumn Header="Starting Price" IsReadOnly="True" Width="*"
                                Binding="{Binding Price, StringFormat={}{0:C0}, UpdateSourceTrigger=PropertyChanged}"/>
                    <DataGridTemplateColumn Header="Size" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox ItemsSource="{Binding SizeOptions, UpdateSourceTrigger=PropertyChanged}"
                                          SelectedItem="{Binding Size, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{DynamicResource ComboBox}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Taste" Width="*">                        
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox ItemsSource="{Binding TasteOptions, UpdateSourceTrigger=PropertyChanged}"
                                          SelectedItem="{Binding Taste, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{DynamicResource ComboBox}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Add" IsReadOnly="True" Width="auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Background="Transparent" BorderThickness="0"
                                        Style="{DynamicResource gridAddButton}"
                                        Command="{Binding DataContext.AddProductToOrderCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}">
                                    <Icon:PackIconMaterial Kind="PlusCircleOutline" Foreground="#222528"/>
                                </Button>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <Border Grid.Row="1" Style="{StaticResource whiteBorder}" Margin="15 7 15 7">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="20*"/>
                    <ColumnDefinition Width="80*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="Add" 
                               VerticalAlignment="Center" 
                               HorizontalAlignment="Left"
                               FontWeight="Medium"
                               Margin="15 0 0 0"/>

                <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Right" Margin="0 0 10 0">
                    <!-- Add Note -->
                    <Button Style="{StaticResource addButton}"
                    Command="{Binding NavigateToNoteViewCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Note"/>
                        </StackPanel>
                    </Button>
                    <!-- Add Price change -->
                    <Button Style="{StaticResource addButton}" 
                    Command="{Binding NavigateToPriceChangeViewCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Price change"/>
                        </StackPanel>
                    </Button>
                    <!-- Add Delivery -->
                    <Button Style="{StaticResource addButton}"
                    Command="{Binding NavigateToDeliveryViewCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Delivery"/>
                        </StackPanel>
                    </Button>
                    <!-- Add Payment -->
                    <Button Style="{StaticResource addButton}"
                    Command="{Binding NavigateToPaymentViewCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Payment"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

            </Grid>
        </Border>


        <Border Grid.Row="2" Style="{StaticResource whiteBorder}" Margin="15 7 15 0">
            <Grid>
                <ContentControl Grid.Row="1" Content="{Binding Navigation.CurrentNestedView}"
                                Margin="15"/>
            </Grid>
        </Border>

        <Grid Grid.Column="1" Grid.RowSpan="3">
            <Grid.RowDefinitions>
                <RowDefinition Height="8*"/>
                <RowDefinition Height="70*"/>
                <RowDefinition Height="15*"/>
                <RowDefinition Height="7*"/>
            </Grid.RowDefinitions>

            <Border Style="{StaticResource whiteBorder}" Margin="0 0 0 7">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="50*"/>
                        <ColumnDefinition Width="50*"/>
                    </Grid.ColumnDefinitions>
                    <!-- Customer section -->
                    <StackPanel VerticalAlignment="Center" Margin="15">
                        <TextBlock Text="FirstName" FontWeight="Medium" FontSize="11"/>
                        <!-- {Binding SelectedCustomer.FirstName, UpdateSourceTrigger=PropertyChanged}"-->
                        <TextBlock Text="PhoneNumber" FontWeight="Medium" FontSize="11"/>
                        <!-- {Binding SelectedCustomer.PhoneNumber, UpdateSourceTrigger=PropertyChanged}" -->
                    </StackPanel>
                    <Button Grid.Column="1" 
                                HorizontalAlignment="Right" 
                                Style="{StaticResource addButton}" 
                                VerticalAlignment="Center"
                                Height="30" Margin="0 0 15 0">
                        <StackPanel Orientation="Horizontal">
                            <Icon:PackIconMaterial Kind="AccountPlusOutline" Margin="0 0 10 0"/>
                            <TextBlock Text="Add Customer"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>

            <Border Grid.Row="1" Style="{StaticResource whiteBorder}" Margin="0 7 0 7">
                <ScrollViewer  VerticalScrollBarVisibility="Auto">
                    <!-- List of orderlines -->
                    <ListBox ItemsSource="{Binding OrderLinesCollectionView, UpdateSourceTrigger=PropertyChanged}"
                         SelectedItem="{Binding SelectedOrderLine, UpdateSourceTrigger=PropertyChanged}"
                         Background="Transparent"
                         HorizontalContentAlignment="Stretch"
                         BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="2">
                                    <!-- Product Name -->
                                    <TextBlock Text="{Binding Product.Name, UpdateSourceTrigger=PropertyChanged}" FontWeight="Light" FontSize="16"/>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Taste.Name, UpdateSourceTrigger=PropertyChanged}" FontWeight="Light"/>
                                        <TextBlock Text="{Binding Size.Name, UpdateSourceTrigger=PropertyChanged}" FontWeight="Light"/>
                                    </StackPanel>

                                    <Grid>
                                        <TextBlock Text="{Binding Price, StringFormat={}{0:C0}, UpdateSourceTrigger=PropertyChanged}" 
                                               FontSize="14"
                                               Margin="0,3,0,3"/>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <Button Background="Transparent" BorderThickness="0"
                                                    Command="{Binding DataContext.DecreaseQuantityCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBox}}}"
                                                    CommandParameter="{Binding}"
                                                    Margin="3">
                                                <Icon:PackIconMaterial Kind="MinusCircleOutline"/>
                                            </Button>

                                            <TextBlock Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged}"
                                                   FontSize="14"
                                                   Margin="3"/>

                                            <Button Background="Transparent" BorderThickness="0" 
                                                Command="{Binding DataContext.IncreaseQuantityCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBox}}}"
                                                    CommandParameter="{Binding}"
                                                HorizontalContentAlignment="Right"
                                                HorizontalAlignment="Right"
                                                Margin="3">
                                                <Icon:PackIconMaterial Kind="PlusCircleOutline"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>
            </Border>

            <!-- Running Total -->
            <Border Grid.Row="2" Background="#e0f5ee" CornerRadius="3">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel HorizontalAlignment="Left">
                        <TextBlock Text="Discount" FontSize="12" FontWeight="Regular"/>
                        <TextBlock Text="Subtotal" FontSize="12" FontWeight="Regular" Margin="0 5 0 0"/>
                        <TextBlock Text="Payable Amount" FontSize="14" FontWeight="Medium" Margin="0 10 0 0"/>
                        <TextBlock Text="Outstanding" FontSize="12" FontWeight="Medium" Margin="0 10 0 0" />
                    </StackPanel>

                    <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                        <TextBlock Text="{Binding DiscountTotal, UpdateSourceTrigger=PropertyChanged}"
                                   FontSize="12" FontWeight="Regular"/>
                        <TextBlock Text="{Binding Subtotal, UpdateSourceTrigger=PropertyChanged}"
                                   FontSize="12" FontWeight="Regular" Margin="0 5 0 0"/>
                        <TextBlock Text="{Binding RunningTotal, UpdateSourceTrigger=PropertyChanged}"
                                   FontSize="14" FontWeight="Medium" VerticalAlignment="Bottom" Margin="0 10 0 0" />
                        <TextBlock Text="{Binding OutstandingAmount, UpdateSourceTrigger=PropertyChanged}"
                                   FontSize="12" FontWeight="Medium" VerticalAlignment="Bottom" Margin="0 10 0 0" />
                    </StackPanel>
                </Grid>
            </Border>
            <!-- Cancel Button -->
            <Button Grid.Row="4"
                    Width="100"
                    Content="Cancel"
                    Command="{Binding NavigateToNewOrderProductsCommand}"
                    Padding="5"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"/>

            <!-- Create Order Button -->
            <Button Grid.Row="4"
                    Width="100"
                    Content="Place Order"
                    Command="{Binding CreateOrderCommand}"
                    Padding="5"
                    HorizontalAlignment="Right"
                VerticalAlignment="Center"/>
        </Grid>
    </Grid>
</UserControl>
